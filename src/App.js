// Generated by BUCKLESCRIPT VERSION 4.0.6, PLEASE EDIT WITH CARE

import * as Block from "bs-platform/lib/es6/block.js";
import * as Curry from "bs-platform/lib/es6/curry.js";
import * as Fluid from "./Fluid.js";
import * as Printf from "bs-platform/lib/es6/printf.js";
import * as Spring from "./Spring.js";
import * as Animate from "./Animate.js";
import * as Caml_obj from "bs-platform/lib/es6/caml_obj.js";
import * as Pervasives from "bs-platform/lib/es6/pervasives.js";
import * as Js_primitive from "bs-platform/lib/es6/js_primitive.js";
import * as Caml_builtin_exceptions from "bs-platform/lib/es6/caml_builtin_exceptions.js";

var Style = /* module */[];

function translate(node, dx, offset) {
  return Animate.spring(1, 10, undefined, (function (amount) {
                node.style.transform = "translateX(" + (Pervasives.string_of_float((1 - amount) * dx + offset) + "px)");
                return /* () */0;
              }), (function () {
                return /* () */0;
              }));
}

var abs = (
function(node) {
  const box = node.getBoundingClientRect();
  node.style.position = 'absolute';
  node.style.pointerEvents = 'none';
  node.style.top = box.top + 'px';
  node.style.left = box.left + 'px';
}
);

function fade(node, out) {
  if (out) {
    Curry._1(abs, node);
  }
  return Animate.spring(1, 10, undefined, (function (amount) {
                node.style.opacity = out ? amount : 1 - amount;
                return /* () */0;
              }), (function () {
                if (out) {
                  node.parentNode.removeChild(node);
                  return /* () */0;
                } else {
                  return 0;
                }
              }));
}

function props(on, off, _) {
  return /* record */[
          /* on */on,
          /* off */off
        ];
}

function maker_001() {
  return false;
}

var maker_003 = /* reconcileTrees */(function (oldState, newState, mountedTree, newTree) {
    var exit = 0;
    if (oldState) {
      if (newState) {
        return mountedTree;
      } else {
        exit = 1;
      }
    } else if (newState) {
      exit = 1;
    } else {
      return mountedTree;
    }
    if (exit === 1) {
      var domNode = Fluid.getDomNode(mountedTree);
      var newTree$1 = Fluid.inflateTree(Fluid.instantiateTree(newTree));
      var newDomNode = Fluid.getDomNode(newTree$1);
      translate(domNode, newState ? -30 : 30, 0);
      fade(domNode, true);
      translate(newDomNode, newState ? -30 : 30, newState ? 30 : -30);
      fade(newDomNode, false);
      domNode.parentNode.insertBefore(newDomNode, domNode);
      return newTree$1;
    }
    
  });

function maker_004(param, state, setState) {
  if (state) {
    return Curry._1(param[/* on */0], (function () {
                  return Curry._1(setState, false);
                }));
  } else {
    return Curry._1(param[/* off */1], (function () {
                  return Curry._1(setState, true);
                }));
  }
}

var maker = /* record */[
  /* name */"Toggle",
  maker_001,
  /* newStateForProps */undefined,
  maker_003,
  maker_004
];

function make(props) {
  return Fluid.Maker[/* makeComponent */0](maker, props);
}

var Toggle = /* module */[
  /* props */props,
  /* maker */maker,
  /* make */make
];

function props$1(value, toString, _) {
  return /* tuple */[
          value,
          toString
        ];
}

function maker_001$1() {
  return "Folks";
}

function maker_004$1(param, state, setState) {
  return /* Builtin */Block.__(1, [
            "div",
            { },
            /* :: */[
              /* Builtin */Block.__(1, [
                  "div",
                  {
                    onclick: (function () {
                        return Curry._1(setState, state + "1");
                      })
                  },
                  /* :: */[
                    /* String */Block.__(0, ["Awesome " + (Curry._1(param[1], param[0]) + (" " + state))]),
                    /* [] */0
                  ]
                ]),
              /* [] */0
            ]
          ]);
}

var maker$1 = /* record */[
  /* name */"Awesome",
  maker_001$1,
  /* newStateForProps */undefined,
  /* reconcileTrees */undefined,
  maker_004$1
];

function make$1(props) {
  return Fluid.Maker[/* makeComponent */0](maker$1, props);
}

var Awesome = /* module */[
  /* props */props$1,
  /* maker */maker$1,
  /* make */make$1
];

function props$2(text, style, onClick, _) {
  return /* tuple */[
          text,
          style,
          onClick
        ];
}

var make$2 = Fluid.Maker[/* component */1]("Button", undefined, (function (param) {
        var onClick = param[2];
        return /* Builtin */Block.__(1, [
                  "button",
                  {
                    onclick: (function () {
                        return Curry._1(onClick, /* () */0);
                      }),
                    style: param[1]
                  },
                  /* :: */[
                    /* String */Block.__(0, [param[0]]),
                    /* [] */0
                  ]
                ]);
      }), /* () */0);

var Button = /* module */[
  /* props */props$2,
  /* make */make$2
];

var canvas = Fluid.createElement("canvas", {
      width: 500,
      height: 200
    });

document.body.appendChild(canvas);

var canvas2 = Fluid.createElement("canvas", {
      width: 500,
      height: 500
    });

document.body.appendChild(canvas2);

var log = Fluid.createElement("div", { });

document.body.appendChild(log);

var plot = (
function (x, y, scale, color) {
  const ctx = canvas.getContext('2d');
  ctx.fillStyle = color
  ctx.fillRect(x, y, scale, scale)
}
);

var visualize = (
  function (canvas, state, advance, isAtRest) {
    canvas.width = 500
    canvas.height = 500
    const ctx = canvas.getContext('2d');
    ctx.clearRect(0, 0, 500, 500);
    ctx.strokeStyle = 'black'
    ctx.lineWidth = 3;
    ctx.beginPath();
    ctx.moveTo(0, 350);
    ctx.stroke()
    for (var i=0; i<500; i++) {
      if (isAtRest(state)) {
        break
      }
      state = advance(16, state);
      ctx.lineTo(i, 250 + state[2] * 100)
    }
    ctx.stroke();
  }
);

function howLong(stiffness, damping) {
  var config = /* record */[
    /* damping */damping,
    /* stiffness */stiffness,
    /* restDisplacementThreshold */0.001,
    /* restVelocityThreshold */0.001
  ];
  var state = Spring.init(0, config);
  var _didOvershoot = false;
  var _state = state;
  var _t = 0;
  while(true) {
    var t = _t;
    var state$1 = _state;
    var didOvershoot = _didOvershoot;
    if (t > 1500) {
      return /* tuple */[
              undefined,
              0
            ];
    } else if (Spring.isAtRest(state$1)) {
      return /* tuple */[
              didOvershoot,
              t
            ];
    } else {
      _t = t + 1 | 0;
      _state = Spring.advance(16, state$1);
      _didOvershoot = didOvershoot || state$1[/* currentValue */2] < 0;
      continue ;
    }
  };
}

function showPlot(stiffness, damping) {
  var config = /* record */[
    /* damping */damping,
    /* stiffness */stiffness,
    /* restDisplacementThreshold */0.001,
    /* restVelocityThreshold */0.001
  ];
  var state = Spring.init(0, config);
  return Curry._4(visualize, canvas2, state, Spring.advance, Spring.isAtRest);
}

var changes = /* array */[];

document.body.awesome = changes;

function sd(x, y) {
  return /* tuple */[
          x / 2 / 1,
          1 + Math.sqrt(y) / 2 / 1
        ];
}

function showLine(x) {
  var last = true;
  for(var y = 0; y <= 200; ++y){
    var x$1 = (x << 0);
    var y$1 = (y << 0);
    var match = sd(x$1, y$1);
    var damping = match[1];
    var stiffness = match[0];
    var match$1 = howLong(stiffness, damping);
    var t = match$1[1];
    var overshoot = match$1[0];
    if (Caml_obj.caml_equal(overshoot, false) && Caml_obj.caml_equal(last, true)) {
      console.log("Change!", /* tuple */[
            overshoot,
            last
          ], stiffness, damping);
      changes.push(/* tuple */[
            stiffness,
            damping
          ]);
    }
    last = overshoot;
    Curry._4(plot, x$1, y$1, 1, overshoot !== undefined ? (
            overshoot ? "rgba(255, 0, 0, " + (Pervasives.string_of_float(t / 2000 + 0.5) + ")") : "rgba(0, 255, 0, " + (Pervasives.string_of_float(t / 2000 + 0.5) + ")")
          ) : "black");
  }
  return /* () */0;
}

function loop(x) {
  showLine(x);
  if (x < 500) {
    requestAnimationFrame((function () {
            return loop(x + 1 | 0);
          }));
    return /* () */0;
  } else {
    return 0;
  }
}

Curry._1((
  function(){
    const ctx = canvas.getContext('2d')
    ctx.beginPath()
    ctx.moveTo(0,0)
    for (let x = 0; x < 500; x++) {
      ctx.lineTo(x, Math.sqrt(2) * Math.sqrt(x / 2) * 5)
    }
    ctx.strokeStyle = 'black'
    ctx.lineWidth = 1
    ctx.stroke()
  }
), /* () */0);

canvas.addEventListener("mousemove", (function (evt) {
        var box = evt.target.getBoundingClientRect();
        var x = evt.clientX - box.left;
        var y = evt.clientY - box.top;
        var match = sd(x, y);
        var damping = match[1];
        var stiffness = match[0];
        showPlot(stiffness, damping);
        var match$1 = howLong(stiffness, damping);
        log.textContent = Curry._3(Printf.sprintf(/* Format */[
                  /* Float */Block.__(8, [
                      /* Float_f */0,
                      /* No_padding */0,
                      /* No_precision */0,
                      /* String_literal */Block.__(11, [
                          " stiffness ",
                          /* Float */Block.__(8, [
                              /* Float_f */0,
                              /* No_padding */0,
                              /* No_precision */0,
                              /* String_literal */Block.__(11, [
                                  " damping; ",
                                  /* Int */Block.__(4, [
                                      /* Int_d */0,
                                      /* No_padding */0,
                                      /* No_precision */0,
                                      /* String_literal */Block.__(11, [
                                          " steps",
                                          /* End_of_format */0
                                        ])
                                    ])
                                ])
                            ])
                        ])
                    ]),
                  "%f stiffness %f damping; %d steps"
                ]), x / 2, y / 5, match$1[1]);
        return /* () */0;
      }));

function props_000(onClick) {
  return /* Builtin */Block.__(1, [
            "div",
            { },
            /* :: */[
              /* String */Block.__(0, ["Click this to"]),
              /* :: */[
                /* Custom */Block.__(2, [Curry._1(make$2, /* tuple */[
                          "Turn Off",
                          "background-color: #88ff88",
                          onClick
                        ])]),
                /* [] */0
              ]
            ]
          ]);
}

function props_001(onClick) {
  return /* Builtin */Block.__(1, [
            "div",
            { },
            /* :: */[
              /* Custom */Block.__(2, [Curry._1(make$2, /* tuple */[
                        "Turn On",
                        "background-color: #ffacf0",
                        onClick
                      ])]),
              /* :: */[
                /* String */Block.__(0, ["if you want"]),
                /* [] */0
              ]
            ]
          ]);
}

var props$3 = /* record */[
  props_000,
  props_001
];

function props_001$1(prim) {
  return String(prim);
}

var props$4 = /* tuple */[
  5,
  props_001$1
];

function props_001$2(x) {
  return x;
}

var props$5 = /* tuple */[
  "Hi",
  props_001$2
];

var first_001 = {
  id: "awesome",
  style: "padding: 20px"
};

var first_002 = /* :: */[
  /* String */Block.__(0, ["Hello"]),
  /* :: */[
    /* Builtin */Block.__(1, [
        "input",
        {
          type: "range",
          oninput: (function (evt) {
              var v = evt.target.value;
              console.log(v);
              var config = /* record */[
                /* damping */v,
                /* stiffness */100,
                /* restDisplacementThreshold */0.001,
                /* restVelocityThreshold */0.001
              ];
              var state = Spring.init(0, config);
              return Curry._4(visualize, canvas2, state, Spring.advance, Spring.isAtRest);
            })
        },
        /* [] */0
      ]),
    /* :: */[
      /* Builtin */Block.__(1, [
          "div",
          {
            id: "here"
          },
          /* :: */[
            /* Builtin */Block.__(1, [
                "div",
                { },
                /* :: */[
                  /* String */Block.__(0, ["What"]),
                  /* [] */0
                ]
              ]),
            /* [] */0
          ]
        ]),
      /* :: */[
        /* Custom */Block.__(2, [Fluid.Maker[/* makeComponent */0](maker, props$3)]),
        /* :: */[
          /* Custom */Block.__(2, [Fluid.Maker[/* makeComponent */0](maker$1, props$4)]),
          /* :: */[
            /* Custom */Block.__(2, [Fluid.Maker[/* makeComponent */0](maker$1, props$5)]),
            /* :: */[
              /* Builtin */Block.__(1, [
                  "div",
                  {
                    id: "Inner"
                  },
                  /* :: */[
                    /* String */Block.__(0, ["world"]),
                    /* [] */0
                  ]
                ]),
              /* [] */0
            ]
          ]
        ]
      ]
    ]
  ]
];

var first = /* Builtin */Block.__(1, [
    "div",
    first_001,
    first_002
  ]);

var match = document.getElementById("root");

if (match !== undefined) {
  Fluid.mount(first, Js_primitive.valFromOption(match));
} else {
  throw [
        Caml_builtin_exceptions.assert_failure,
        /* tuple */[
          "App.re",
          318,
          12
        ]
      ];
}

var scale = 1;

var zoom = 1;

export {
  Style ,
  translate ,
  abs ,
  fade ,
  Toggle ,
  Awesome ,
  Button ,
  canvas ,
  canvas2 ,
  log ,
  plot ,
  visualize ,
  howLong ,
  showPlot ,
  scale ,
  zoom ,
  changes ,
  sd ,
  showLine ,
  loop ,
  first ,
  
}
/* abs Not a pure module */
